#!/usr/bin/env bash

# Install net-tools package for netstat command
sudo apt-get update
sudo apt-get install net-tools -y

# Check if anything is already listening on port 80
existing_pid=$(sudo netstat -tuln | grep :80 | awk '{print $7}' | awk -F '/' '{print $1}')

if [[ -n "$existing_pid" ]]; then
	echo "A process with PID $existing_pid is already listening on port 80."
	echo "Please stop or terminate that process before configuring Nginx."
	exit 1
fi

# Update Nginx configuration to listen on port 80
sudo sed -i 's/listen\s*\(.*\);/listen 80;/g' /etc/nginx/nginx.conf

# Restart Nginx service
sudo systemctl restart nginx

echo "Nginx has been configured to listen on port 80."

exit 0
